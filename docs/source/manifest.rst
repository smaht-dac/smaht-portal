==============================================
Understanding SMaHT Data Portal Manifest Files
==============================================

Please use the ``manifest`` file to download data from the SMaHT Data Portal.

It passes portal access credentials to the command provided in the ``smaht_manifest`` files downloaded from the portal.

In the ``manifest`` file, multiple values in a field under a column are separated by the pipe (``|``) character.

Below are the columns listed in the ``manifest`` files as of the May 2024 data release.

#. **File Download URL** - This URL calls an API that authorizes the calling user and redirects to a pre-signed URL to download the file.

#. **File Accession** - This value is generated by the SMaHT data portal, it is a unique value  except for extra files associated with a actual file will have the same accession but different file extension. E.g. When a BAM file (*.bam) is selected to download, an index file (*.bai) is the associated extra file that is also downloaded along with it.

#. **File Name** - This value is a file name that also serves as a unique identifier of the file. The file nomenclature schema is described `here <https://data.smaht.org/docs/additional-resources/sample-file-nomenclature>`_.

#. **Size** - File size in bytes.

#. **md5sum** - md5 of the file content.

#. **Data Type** - This value tells you the file type, e.g. ``Aligned Reads``, ``Unaligned Reads`` or ``Variant Calls``.

#. **File Format** - Format of the file (e.g. bam, fastq.gz).

#. **Sample Name** - Sample identifier in SMaHT nomenclature. Please refer to the file nomenclature schema is described `here <https://data.smaht.org/docs/additional-resources/sample-file-nomenclature>`_.

#. **Sample Studies** - Studies associated with this file; Benchmarking or Production.

#. **Sample Tissues** - Tissues used to generate this file, if applicable.

#. **Sample Donors** - Similarly, the donors from which the above tissues were generated.

#. **Sample Source** - Sample name provided by a data submitter. If the file is generated from a mixture of samples (e.g. HapMap mix, COLO829-BLT), multiple sample sources will be found here, delimited by ``|``.

#. **Analytes** - Analytes used for analysis, e.g. one of ``RNA``, ``DNA``.

#. **Sequencer** - Name of the sequencing platform used to generate the raw sequencing data e.g. ``PacBio Revio``.

#. **Assay** - Experimental assay used to generate this file, e.g. ``WGS, PCR Free``.

#. **Software Name/Version** - Name and version of software used to generate this file, e.g. ``pbmm2 (1.13.0)``.

#. **Reference Genome** - Reference Genome version used for the analysis, e.g. ``GRCh38 [GCA_000001405.15]``.

#. **File Merge Group** - This field indicates a group of BAM files that can be merged. BAM files with the identical file merge group value can be merged. Please see the dedicated section below for more information.


----------------
File Merge Group
----------------

The ``File Merge Group`` field is a special field that indicates which BAM files can be merged. To efficiently process and store large BAMs with high sequencing coverage, the alignment pipeline at DAC produces BAMs per library. To identify BAMs to merge, obtain the files where the file format is BAM and the File Merge Group values are identical.

Specifically, the ``File Merge Group`` combines several pieces of information, including:

* The center that submitted the raw sequencing data
* Aggregated sample source information
* Aggregated sequencing platform information
* Aggregated experimental assay information

For example:

File Merge Group = ``bcm_gcc-WASHU_CELL-CULTURE-MIXTURE_SMAHT_CORIELL_POOL1-pacbio_revio_hifi-Single-end-17500-no-flow-cell-bulk_wgs_pcr_free``

* ``bcm_gcc`` = Submission center which indicates that ``BCM-GCC`` submitted the sequencing data.
* ``WASHU_CELL-CULTURE-MIXTURE_SMAHT_CORIELL_POOL1`` = Sample Source which indicates this file was generated from SMAHT CORIELL POOL1 sample source, a name designated by the data submitter at BCM.
* ``pacbio_revio_hifi-Single-end-17500-no-flow-cell`` = Sequencing, which indicates that this file was generated from a PacBio Revio sequencer with target read length 17500 and no flow cell information.
* ``bulk_wgs_pcr_free`` = Experimental assay.

*Please note this functionality is provisional and subject to change. If you encounter issues with this functionality, please report it to DAC!*
